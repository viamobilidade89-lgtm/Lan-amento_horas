<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Lançamentos SAP</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f4f6f8; margin: 20px; color: #333; }
        h1, h2, h3 { text-align: center; color: #5E22F3; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .secao-acao { display: flex; flex-direction: column; gap: 15px; align-items: center; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .linha-input { display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap; justify-content: center; }
        
        select, input, button { padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #5E22F3; color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #4517b8; }
        
        .selecao-nomes { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; width: 100%; margin-top: 15px; background: #f9f9f9; padding: 10px; border-radius: 5px; border: 1px dashed #5E22F3; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background-color: white; }
        thead { background-color: #5E22F3; color: white; }
        th, td { padding: 10px; text-align: center; border-bottom: 1px solid #ddd; }
        
        footer { text-align:center; padding:15px; color:white; background-color:#5E22F3; margin-top: 30px; border-radius: 8px; }
    </style>
</head>
<body>

    <h1>Gerenciador de Equipe SAP</h1>

    <div class="container">
        <h3>Passo 1: Definir Equipe</h3>
        <div class="secao-acao">
            <div class="linha-input">
                <div>
                    <label>Quantidade de Pessoas:</label><br>
                    <input type="number" id="qtdPessoas" min="1" placeholder="Ex: 2">
                </div>
                <button onclick="gerarCamposSelecao()">Definir Quantidade</button>
            </div>
            <div id="containerNomes" class="selecao-nomes" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h3>Passo 2: Ordem e Operações</h3>
        <div class="secao-acao">
            <div class="linha-input">
                <div>
                    <label>Número da Ordem:</label><br>
                    <input type="number" id="numeroOrdem" placeholder="Digite a ordem">
                </div>
                <button onclick="adicionarOperacao()">Adicionar Operação</button>
            </div>

            <table id="tabelaOperacoes" style="width: 100%;">
                <thead>
                    <tr>
                        <th>Operação</th>
                        <th>Código</th>
                        <th>Início (Data/Hora)</th>
                        <th>Fim (Data/Hora)</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div style="text-align: center; margin-bottom: 20px;">
        <button id="btnGerar" style="padding: 15px 30px; font-size: 16px; background-color: #28a745;" onclick="processarLancamento()">GERAR LANÇAMENTO FINAL</button>
        <button onclick="window.location.reload()" style="background-color: #6c757d;">Limpar Tudo</button>
    </div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>Preview para Lançamento (ZPM)</h2>
            <button onclick="copiarZPM()" style="background-color: #007bff;">Copiar para SAP</button>
        </div>
        <table id="tabelaLancto">
            <thead>
                <tr>
                    <th>Ordem</th><th>Cód.</th><th>Número</th><th>Data Iní.</th><th>Hora Iní.</th><th>Data Fim</th><th>Hora Fim</th><th>Confirmação</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <footer>Criado por <strong>Lucas Santana</strong> - Equipe Sinalização © 2025</footer>

    <script>
        const colaboradores = [
            {"nome":"ADRIANO","re":"59-01777","numero":"20579"},
            {"nome":"ALEX","re":"59-02966","numero":"23097"},
            {"nome":"BRUNO","re":"59-04951","numero":"19540"},
            {"nome":"CLAUDEMIR","re":"59-01651","numero":"20651"},
            {"nome":"EUDES","re":"59-03110","numero":""},
            {"nome":"GILMERSON","re":"59-02315","numero":"24056"},
            {"nome":"GRACINO","re":"59-00447","numero":"20806"},
            {"nome":"GREGÓRIO","re":"59-02738","numero":""},
            {"nome":"IAGO","re":"59-02975","numero":"23584"},
            {"nome":"JAILSON","re":"59-03141","numero":"23924"},
            {"nome":"JONE","re":"59-02967","numero":"24207"},
            {"nome":"JUNIOR","re":"59-01825","numero":"20903"},
            {"nome":"KAMILYN","re":"59-04350","numero":"24587"},
            {"nome":"LEANDRO","re":"59-03077","numero":"14791"},
            {"nome":"LUCIANO","re":"59-03444","numero":"23090"},
            {"nome":"MARCELO","re":"59-02318","numero":"23672"},
            {"nome":"PAULO","re":"59-01797","numero":"21031"},
            {"nome":"RODRIGO","re":"59-02849","numero":""},
            {"nome":"RUTEMBERG","re":"59-00332","numero":"21096"},
            {"nome":"SIDNEI","re":"59-03370","numero":"24520"},
            {"nome":"VAGNER","re":"59-04500","numero":"24932"},
            {"nome":"VALTER","re":"59-00793","numero":"21131"},
            {"nome":"WILLIAM FAUSTO","re":"59-04340","numero":"24435"},
            {"nome":"WILLIAN ALMEIDA","re":"59-03331","numero":"22589"}
        ].sort((a,b) => a.nome.localeCompare(b.nome));

        const opsBase = [
            {n: "Preparação", c: "0010"}, {n: "Deslocamento", c: "0020"},
            {n: "Acesso", c: "0030"}, {n: "Impedimento", c: "0040"},
            {n: "Desmobilização", c: "0050"}, {n: "Execução", c: "0060"}
        ];

        // FUNÇÃO DO BOTÃO 1
        function gerarCamposSelecao() {
            const qtd = document.getElementById('qtdPessoas').value;
            const container = document.getElementById('containerNomes');
            container.innerHTML = "";
            if (qtd < 1) return alert("Digite uma quantidade válida.");

            container.style.display = "grid";
            for (let i = 1; i <= qtd; i++) {
                let options = `<option value="">Selecione o Colaborador ${i}</option>`;
                colaboradores.forEach(c => {
                    options += `<option value="${c.re}">${c.nome} (${c.re})</option>`;
                });
                container.innerHTML += `<div style="display:flex; flex-direction:column;"><label style="font-size:10px">Pessoa ${i}</label><select class="sel-re">${options}</select></div>`;
            }
        }

        // FUNÇÃO DO BOTÃO 2
        function adicionarOperacao() {
            const ord = document.getElementById('numeroOrdem').value;
            if (!ord) return alert("Digite o número da Ordem primeiro.");

            const tbody = document.querySelector("#tabelaOperacoes tbody");
            const tr = document.createElement("tr");
            
            let optOps = "";
            opsBase.forEach(o => { optOps += `<option value="${o.c}">${o.n} (${o.c})</option>`; });

            let hoje = new Date().toISOString().slice(0,10);

            tr.innerHTML = `
                <td><select class="row-cod-op">${optOps}</select></td>
                <td class="display-cod">${opsBase[0].c}</td>
                <td><input type="date" value="${hoje}"> <input type="time" class="h-ini"></td>
                <td><input type="date" value="${hoje}"> <input type="time" class="h-fim"></td>
                <td><button onclick="this.closest('tr').remove()" style="background:#d9534f">X</button></td>
                <td style="display:none" class="row-ordem">${ord}</td>
            `;
            
            const sel = tr.querySelector('.row-cod-op');
            sel.onchange = () => tr.querySelector('.display-cod').textContent = sel.value;
            
            tbody.appendChild(tr);
        }

        // GERAÇÃO FINAL
        function processarLancamento() {
            const resSelecionados = Array.from(document.querySelectorAll('.sel-re')).map(s => s.value).filter(v => v !== "");
            if (resSelecionados.length === 0) return alert("Selecione os colaboradores no Passo 1.");

            const opsRows = document.querySelectorAll("#tabelaOperacoes tbody tr");
            if (opsRows.length === 0) return alert("Adicione pelo menos uma operação no Passo 2.");

            const tbodyFinal = document.querySelector("#tabelaLancto tbody");
            tbodyFinal.innerHTML = "";

            opsRows.forEach(row => {
                const ordem = row.querySelector('.row-ordem').textContent;
                const cod = row.querySelector('.row-cod-op').value;
                const dataIn = row.querySelectorAll('input[type="date"]')[0].value.split("-").reverse().join(".");
                const dataFim = row.querySelectorAll('input[type="date"]')[1].value.split("-").reverse().join(".");
                const hIn = row.querySelector('.h-ini').value;
                const hFim = row.querySelector('.h-fim').value;

                if(!hIn || !hFim) return;

                resSelecionados.forEach(re => {
                    const p = colaboradores.find(c => c.re === re);
                    const tr = document.createElement("tr");
                    let obs = p.numero === "" ? `${p.nome} ${p.re}` : "";
                    tr.innerHTML = `<td>${ordem}</td><td>${cod}</td><td>${p.numero}</td><td>${dataIn}</td><td>${hIn}:00</td><td>${dataFim}</td><td>${hFim}:00</td><td>${obs}</td>`;
                    tbodyFinal.appendChild(tr);
                });
            });
        }

        function copiarZPM() {
            let texto = "";
            document.querySelectorAll("#tabelaLancto tbody tr").forEach(linha => {
                const col = linha.querySelectorAll("td");
                const ord = col[0].textContent;
                const cod = col[1].textContent;
                const dados = Array.from(col).slice(2, 7).map(c => c.textContent);
                const conf = col[7].textContent;
                // Formato tabulado para o SAP
                texto += `${ord}\t${cod}${"\t".repeat(8)}${dados.join("\t")}\t\t${conf}\n`;
            });
            navigator.clipboard.writeText(texto).then(() => alert("Copiado! Basta colar no SAP."));
        }
    </script>
</body>
</html>
