<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador SAP - Subestação Edition</title>
    <style>
        /* Fundo com imagem de Subestação e efeito de Relâmpago */
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            margin: 20px; 
            color: #333; 
            background-color: #e5e7eb;
            /* Link de imagem de subestação em alta resolução */
            background-image: linear-gradient(rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6)), 
                              url('https://images.unsplash.com/photo-1558444479-c84826027ec2?auto=format&fit=crop&q=80&w=1920');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            animation: relampago-subestacao 10s infinite;
        }

        /* Animação que cria o clarão de um trovão */
        @keyframes relampago-subestacao {
            0%, 94%, 100% { filter: brightness(1) contrast(1); }
            95% { filter: brightness(2.2) contrast(1.1); }
            97% { filter: brightness(1.2); }
            98% { filter: brightness(2.5) contrast(1.3); }
        }

        h1, h3 { text-align: center; color: #5E22F3; text-shadow: 1px 1px 2px white; }
        
        /* Containers com transparência muito reduzida para facilitar a leitura */
        .container { 
            background-color: rgba(255, 255, 255, 0.96); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            border: 1px solid #ddd;
        }

        .secao-acao { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fff; }
        .linha-input { display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap; justify-content: center; margin-bottom: 10px; }
        
        select, input, button { padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #5E22F3; color: white; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background-color: #4517b8; }
        
        .grid-selecao { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; margin-top: 15px; padding: 15px; background: #f9f9f9; border-radius: 5px; border: 1px dashed #5E22F3; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; background: white; }
        thead { background-color: #5E22F3; color: white; }
        th, td { padding: 10px; text-align: center; border: 1px solid #eee; }
        
        .btn-gerar { background-color: #28a745; width: 100%; padding: 16px; font-size: 18px; margin-top: 10px; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        footer { text-align:center; padding:15px; color:white; background-color: #5E22F3; margin-top: 30px; border-radius: 8px; }
    </style>
</head>
<body>

    <h1>Gerenciador de Equipe SAP ⚡</h1>

    <div class="container">
        <h3>1. Cadastrar Novo Colaborador</h3>
        <div class="secao-acao">
            <div class="linha-input">
                <input type="text" id="cadNome" placeholder="Nome Completo">
                <input type="text" id="cadRE" placeholder="RE (Ex: 59-0000)">
                <input type="text" id="cadSAP" placeholder="Nº SAP">
                <button onclick="salvarColaborador()">Salvar</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h3>2. Definição da Equipe</h3>
        <div class="secao-acao">
            <div class="linha-input">
                <input type="number" id="qtdEquipe" min="1" placeholder="Qtd Pessoas">
                <button onclick="gerarCamposSelecao()">Gerar Campos</button>
            </div>
            <div id="areaSelecao" class="grid-selecao" style="display: none;"></div>
        </div>
    </div>

    <div class="container">
        <h3>3. Ordem e Operações</h3>
        <div class="secao-acao">
            <div class="linha-input">
                <input type="number" id="numOrdem" placeholder="Nº da Ordem">
                <button onclick="addOperacao()">+ Adicionar Operação</button>
            </div>
            <table id="tabOperacoes">
                <thead>
                    <tr><th>Operação</th><th>Cód.</th><th>Início</th><th>Fim</th><th>Ação</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <button class="btn-gerar" onclick="processarFinal()">GERAR PLANILHA FINAL</button>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h2>Preview ZPM</h2>
            <button style="background-color: #007bff; padding: 10px; color: white; border:none; border-radius:5px;" onclick="copiarZPM()">Copiar Dados</button>
        </div>
        <table id="tabFinal">
            <thead>
                <tr><th>Ordem</th><th>Cód.</th><th>Número</th><th>Data Iní.</th><th>Hora Iní.</th><th>Data Fim</th><th>Hora Fim</th><th>Confirmação</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <footer>Equipe Sinalização © 2026</footer>

<script>
    // Base de dados preservada
    const baseColab = [
        {"nome":"ADRIANO","re":"59-01777","numero":"20579"},{"nome":"ALEX","re":"59-02966","numero":"23097"},
        {"nome":"BRUNO","re":"59-04951","numero":"19540"},{"nome":"CLAUDEMIR","re":"59-01651","numero":"20651"},
        {"nome":"EUDES","re":"59-03110","numero":""},{"nome":"GILMERSON","re":"59-02315","numero":"24056"},
        {"nome":"GRACINO","re":"59-00447","numero":"20806"},{"nome":"GREGÓRIO","re":"59-02738","numero":""},
        {"nome":"IAGO","re":"59-02975","numero":"23584"},{"nome":"JAILSON","re":"59-03141","numero":"23924"},
        {"nome":"JONE","re":"59-02967","numero":"24207"},{"nome":"JUNIOR","re":"59-01825","numero":"20903"},
        {"nome":"KAMILYN","re":"59-04350","numero":"24587"},{"nome":"LEANDRO","re":"59-03077","numero":"14791"},
        {"nome":"LUCIANO","re":"59-03444","numero":"23090"},{"nome":"MARCELO","re":"59-02318","numero":"23672"},
        {"nome":"PAULO","re":"59-01797","numero":"21031"},{"nome":"RODRIGO","re":"59-02849","numero":""},
        {"nome":"RUTEMBERG","re":"59-00332","numero":"21096"},{"nome":"SIDNEI","re":"59-03370","numero":"24520"},
        {"nome":"VAGNER","re":"59-04500","numero":"24932"},{"nome":"VALTER","re":"59-00793","numero":"21131"},
        {"nome":"WILLIAM FAUSTO","re":"59-04340","numero":"24435"},{"nome":"WILLIAN ALMEIDA","re":"59-03331","numero":"22589"}
    ];

    let db = JSON.parse(localStorage.getItem('db_sinaliza_v_final')) || baseColab;

    const todasAsOps = [
        {n: "Preparação", c: "0010"}, {n: "Deslocamento", c: "0020"},
        {n: "Acesso", c: "0030"}, {n: "Impedimento", c: "0040"},
        {n: "Desmobilização", c: "0050"}, {n: "Execução 0060", c: "0060"},
        {n: "Execução 0070", c: "0070"}, {n: "Execução 0080", c: "0080"},
        {n: "Execução 0090", c: "0090"}
    ];

    function salvarColaborador() {
        const n = document.getElementById('cadNome').value.toUpperCase();
        const r = document.getElementById('cadRE').value;
        const s = document.getElementById('cadSAP').value;
        if(!n || !r) return alert("Preencha Nome e RE.");
        db.push({nome: n, re: r, numero: s});
        localStorage.setItem('db_sinaliza_v_final', JSON.stringify(db));
        location.reload();
    }

    function gerarCamposSelecao() {
        const qtd = document.getElementById('qtdEquipe').value;
        const area = document.getElementById('areaSelecao');
        if(qtd < 1) return;
        area.innerHTML = ""; area.style.display = "grid";
        db.sort((a,b) => a.nome.localeCompare(b.nome));
        for(let i=1; i<=qtd; i++) {
            let opts = `<option value="">-- Selecionar ${i} --</option>`;
            db.forEach(c => { opts += `<option value="${c.re}">${c.nome} (${c.re})</option>`; });
            area.innerHTML += `<div><select class="sel-re">${opts}</select></div>`;
        }
    }

    function addOperacao() {
        const ord = document.getElementById('numOrdem').value;
        if(!ord) return alert("Informe a Ordem.");
        const tbody = document.querySelector("#tabOperacoes tbody");
        const tr = document.createElement("tr");
        let opsHTML = todasAsOps.map(o => `<option value="${o.c}">${o.n}</option>`).join('');
        let hoje = new Date().toISOString().slice(0,10);
        tr.innerHTML = `
            <td><select class="op-select">${opsHTML}</select></td>
            <td class="op-cod-cell">${todasAsOps[0].c}</td>
            <td><input type="date" value="${hoje}"> <input type="time"></td>
            <td><input type="date" value="${hoje}"> <input type="time"></td>
            <td><button onclick="this.closest('tr').remove()" style="background:#d9534f">X</button></td>
            <td style="display:none" class="hidden-ordem">${ord}</td>
        `;
        const sel = tr.querySelector('.op-select');
        sel.onchange = () => tr.querySelector('.op-cod-cell').textContent = sel.value;
        tbody.appendChild(tr);
    }

    function processarFinal() {
        const resBody = document.querySelector("#tabFinal tbody");
        resBody.innerHTML = "";
        const selecionados = Array.from(document.querySelectorAll('.sel-re')).map(s => s.value).filter(v => v !== "");
        const rows = document.querySelectorAll("#tabOperacoes tbody tr");
        if(selecionados.length === 0 || rows.length === 0) return alert("Verifique equipe e operações.");
        rows.forEach(row => {
            const ordem = row.querySelector('.hidden-ordem').textContent;
            const cod = row.querySelector('.op-cod-cell').textContent;
            const dtIni = row.querySelectorAll('input[type="date"]')[0].value.split("-").reverse().join(".");
            const dtFim = row.querySelectorAll('input[type="date"]')[1].value.split("-").reverse().join(".");
            const hrIni = row.querySelectorAll('input[type="time"]')[0].value || "00:00";
            const hrFim = row.querySelectorAll('input[type="time"]')[1].value || "00:00";
            selecionados.forEach(re => {
                const p = db.find(c => c.re === re);
                const tr = document.createElement("tr");
                let txtConf = p.numero === "" ? `UNKNOWN: ${p.nome} ${p.re}` : "";
                tr.innerHTML = `<td>${ordem}</td><td>${cod}</td><td>${p.numero}</td><td>${dtIni}</td><td>${hrIni}:00</td><td>${dtFim}</td><td>${hrFim}:00</td><td>${txtConf}</td>`;
                resBody.appendChild(tr);
            });
        });
    }

    function copiarZPM() {
        let texto = "";
        document.querySelectorAll("#tabFinal tbody tr").forEach(tr => {
            const c = Array.from(tr.querySelectorAll("td")).map(td => td.textContent.trim());
            texto += `${c[0]}\t${c[1]}${"\t".repeat(8)}${c[2]}\t${c[3]}\t${c[4]}\t${c[5]}\t${c[6]}\t\t${c[7]}\n`;
        });
        navigator.clipboard.writeText(texto).then(() => alert("Copiado!"));
    }
</script>
</body>
</html>
