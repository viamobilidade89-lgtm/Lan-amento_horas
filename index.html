<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador SAP - Pro Edition</title>
    <style>
        :root {
            --primary-color: #5E22F3;
            --bg-color: #f4f7f9;
            --text-color: #333333;
            --container-bg: #ffffff;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background-color: var(--bg-color); 
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        h1, h2, h3 { color: var(--primary-color); text-align: center; }

        /* Menu de Abas */
        .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            padding: 10px 20px; cursor: pointer; border: none; 
            background: #ddd; border-radius: 5px; font-weight: bold; 
        }
        .tab-btn.active { background: var(--primary-color); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .container { 
            max-width: 900px; margin: 0 auto 20px auto;
            background: var(--container-bg); padding: 20px; 
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }

        .linha-input { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; }
        input, select, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        
        button { 
            background-color: var(--primary-color); color: white; 
            border: none; cursor: pointer; font-weight: bold; 
        }
        button:hover { opacity: 0.9; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 14px; }
        thead { background: var(--primary-color); color: white; }

        /* Estilo Configurações */
        .config-item { margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #eee; }
        .config-item label { display: block; margin-bottom: 5px; font-weight: bold; }
        .btn-danger { background-color: #d9534f; }

        footer { text-align: center; margin-top: 40px; font-size: 12px; opacity: 0.6; }
    </style>
</head>
<body>

    <h1>Sistema de Apoio SAP ⚡</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('operacional')">Operacional</button>
        <button class="tab-btn" onclick="openTab('configuracoes')">Configurações & Banco</button>
    </div>

    <div id="operacional" class="tab-content active">
        <div class="container">
            <h3>1. Equipe e Ordem</h3>
            <div class="linha-input">
                <input type="number" id="numOrdem" placeholder="Nº da Ordem">
                <input type="number" id="qtdEquipe" min="1" placeholder="Qtd de Pessoas">
                <button onclick="gerarCamposSelecao()">Definir Equipe</button>
            </div>
            <div id="areaSelecao" class="linha-input" style="margin-top:10px;"></div>
        </div>

        <div class="container">
            <h3>2. Lançar Operações</h3>
            <div class="linha-input">
                <button onclick="addOperacao()">+ Adicionar Operação (0010-0090)</button>
            </div>
            <table id="tabOperacoes">
                <thead>
                    <tr><th>Operação</th><th>Início</th><th>Fim</th><th>Ações</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <button onclick="processarFinal()" style="width:100%; margin-top:20px; background:#28a745; padding:15px;">GERAR DADOS PARA SAP</button>
        </div>

        <div class="container">
            <h3>3. Resultado (ZPM)</h3>
            <table id="tabFinal">
                <thead>
                    <tr><th>Ordem</th><th>Oper.</th><th>Nº SAP</th><th>Início</th><th>Fim</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <button onclick="copiarZPM()" style="margin-top:10px; background:#007bff;">Copiar Todos os Dados</button>
        </div>
    </div>

    <div id="configuracoes" class="tab-content">
        <div class="container">
            <h3>Personalização de Cores</h3>
            <div class="linha-input">
                <div class="config-item">
                    <label>Cor Principal (Botões/Títulos):</label>
                    <input type="color" id="colorPrimary" value="#5E22F3" onchange="updateColors()">
                </div>
                <div class="config-item">
                    <label>Cor do Fundo:</label>
                    <input type="color" id="colorBg" value="#f4f7f9" onchange="updateColors()">
                </div>
                <div class="config-item">
                    <label>Cor do Texto:</label>
                    <input type="color" id="colorText" value="#333333" onchange="updateColors()">
                </div>
            </div>
        </div>

        <div class="container">
            <h3>Gerenciar Colaboradores</h3>
            <div class="linha-input" style="background: #f9f9f9; padding: 15px; border-radius: 5px;">
                <input type="text" id="cadNome" placeholder="Nome">
                <input type="text" id="cadRE" placeholder="RE">
                <input type="text" id="cadSAP" placeholder="Nº SAP">
                <button onclick="salvarColaborador()">+ Cadastrar</button>
            </div>
            <table id="tabGerenciarBanco">
                <thead>
                    <tr><th>Nome</th><th>RE</th><th>SAP</th><th>Ação</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <footer>Gerenciador de Equipe SAP - Versão 7.0</footer>

<script>
    // Banco de dados inicial
    const baseColab = [
        {"nome":"ADRIANO","re":"59-01777","numero":"20579"},{"nome":"ALEX","re":"59-02966","numero":"23097"},
        {"nome":"BRUNO","re":"59-04951","numero":"19540"},{"nome":"CLAUDEMIR","re":"59-01651","numero":"20651"},
        {"nome":"EUDES","re":"59-03110","numero":""},{"nome":"GILMERSON","re":"59-02315","numero":"24056"},
        {"nome":"GRACINO","re":"59-00447","numero":"20806"},{"nome":"GREGÓRIO","re":"59-02738","numero":""},
        {"nome":"IAGO","re":"59-02975","numero":"23584"},{"nome":"JAILSON","re":"59-03141","numero":"23924"},
        {"nome":"JONE","re":"59-02967","numero":"24207"},{"nome":"JUNIOR","re":"59-01825","numero":"20903"},
        {"nome":"KAMILYN","re":"59-04350","numero":"24587"},{"nome":"LEANDRO","re":"59-03077","numero":"14791"},
        {"nome":"LUCIANO","re":"59-03444","numero":"23090"},{"nome":"MARCELO","re":"59-02318","numero":"23672"},
        {"nome":"PAULO","re":"59-01797","numero":"21031"},{"nome":"RODRIGO","re":"59-02849","numero":""},
        {"nome":"RUTEMBERG","re":"59-00332","numero":"21096"},{"nome":"SIDNEI","re":"59-03370","numero":"24520"},
        {"nome":"VAGNER","re":"59-04500","numero":"24932"},{"nome":"VALTER","re":"59-00793","numero":"21131"},
        {"nome":"WILLIAM FAUSTO","re":"59-04340","numero":"24435"},{"nome":"WILLIAN ALMEIDA","re":"59-03331","numero":"22589"}
    ];

    let db = JSON.parse(localStorage.getItem('db_sap_v7')) || baseColab;

    const todasAsOps = [
        {n: "Preparação", c: "0010"}, {n: "Deslocamento", c: "0020"},
        {n: "Acesso", c: "0030"}, {n: "Impedimento", c: "0040"},
        {n: "Desmobilização", c: "0050"}, {n: "Execução 0060", c: "0060"},
        {n: "Execução 0070", c: "0070"}, {n: "Execução 0080", c: "0080"},
        {n: "Execução 0090", c: "0090"}
    ];

    // Funções de Interface
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabName === 'configuracoes') renderGerenciarBanco();
    }

    function updateColors() {
        const p = document.getElementById('colorPrimary').value;
        const b = document.getElementById('colorBg').value;
        const t = document.getElementById('colorText').value;
        document.documentElement.style.setProperty('--primary-color', p);
        document.documentElement.style.setProperty('--bg-color', b);
        document.documentElement.style.setProperty('--text-color', t);
    }

    // Gerenciamento de Banco
    function salvarColaborador() {
        const nome = document.getElementById('cadNome').value.toUpperCase();
        const re = document.getElementById('cadRE').value;
        const sap = document.getElementById('cadSAP').value;
        if(!nome || !re) return alert("Preencha ao menos Nome e RE");
        db.push({nome, re, numero: sap});
        localStorage.setItem('db_sap_v7', JSON.stringify(db));
        renderGerenciarBanco();
        alert("Cadastrado com sucesso!");
    }

    function excluirColaborador(index) {
        if(confirm("Deseja realmente excluir este colaborador?")) {
            db.splice(index, 1);
            localStorage.setItem('db_sap_v7', JSON.stringify(db));
            renderGerenciarBanco();
        }
    }

    function renderGerenciarBanco() {
        const tbody = document.querySelector("#tabGerenciarBanco tbody");
        tbody.innerHTML = "";
        db.sort((a,b) => a.nome.localeCompare(b.nome)).forEach((colab, index) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${colab.nome}</td><td>${colab.re}</td><td>${colab.numero}</td>
                <td><button class="btn-danger" onclick="excluirColaborador(${index})">Excluir</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    // Lógica Operacional
    function gerarCamposSelecao() {
        const qtd = document.getElementById('qtdEquipe').value;
        const area = document.getElementById('areaSelecao');
        area.innerHTML = "";
        db.sort((a,b) => a.nome.localeCompare(b.nome));
        for(let i=0; i<qtd; i++) {
            let select = `<select class="sel-re"><option value="">-- Selecionar --</option>`;
            db.forEach(c => select += `<option value="${c.re}">${c.nome}</option>`);
            select += `</select>`;
            area.innerHTML += select;
        }
    }

    function addOperacao() {
        const tbody = document.querySelector("#tabOperacoes tbody");
        const tr = document.createElement("tr");
        let opsOptions = todasAsOps.map(o => `<option value="${o.c}">${o.n} (${o.c})</option>`).join('');
        let hoje = new Date().toISOString().slice(0,10);
        tr.innerHTML = `
            <td><select class="op-cod">${opsOptions}</select></td>
            <td><input type="date" value="${hoje}"> <input type="time"></td>
            <td><input type="date" value="${hoje}"> <input type="time"></td>
            <td><button class="btn-danger" onclick="this.closest('tr').remove()">X</button></td>
        `;
        tbody.appendChild(tr);
    }

    function processarFinal() {
        const resBody = document.querySelector("#tabFinal tbody");
        resBody.innerHTML = "";
        const ordem = document.getElementById('numOrdem').value;
        const selecionados = Array.from(document.querySelectorAll('.sel-re')).map(s => s.value).filter(v => v !== "");
        const rows = document.querySelectorAll("#tabOperacoes tbody tr");

        if(!ordem || selecionados.length === 0) return alert("Preencha a ordem e a equipe.");

        rows.forEach(row => {
            const cod = row.querySelector('.op-cod').value;
            const dtIni = row.querySelectorAll('input[type="date"]')[0].value.split("-").reverse().join(".");
            const hrIni = row.querySelectorAll('input[type="time"]')[0].value || "00:00";
            const dtFim = row.querySelectorAll('input[type="date"]')[1].value.split("-").reverse().join(".");
            const hrFim = row.querySelectorAll('input[type="time"]')[1].value || "00:00";

            selecionados.forEach(re => {
                const p = db.find(c => c.re === re);
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${ordem}</td><td>${cod}</td><td>${p.numero}</td><td>${dtIni} ${hrIni}</td><td>${dtFim} ${hrFim}</td>`;
                resBody.appendChild(tr);
            });
        });
    }

    function copiarZPM() {
        let txt = "";
        document.querySelectorAll("#tabFinal tbody tr").forEach(tr => {
            const tds = tr.querySelectorAll("td");
            txt += `${tds[0].textContent}\t${tds[1].textContent}${"\t".repeat(8)}${tds[2].textContent}\t${tds[3].textContent}\t${tds[4].textContent}\n`;
        });
        navigator.clipboard.writeText(txt).then(() => alert("Copiado para o SAP!"));
    }
</script>
</body>
</html>
